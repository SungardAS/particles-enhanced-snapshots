{{#layout}}

  {{parameter "key_name" logicalId="KeyName"}}

  {{parameter "image_id" "base" logicalId="ImageId"}}

  {{parameter "instance_type" logicalId="InstanceType"}}

  {{parameter "vpc_id" logicalId="VpcId"}}

  {{parameter "name_tag" logicalId="NameTag"}}

  {{resource 'user' logicalId="User"}}

  {{resource 'access_key' logicalId="AccessKey"}}

  {{
    resource 'security_group'
    logicalId="SecurityGroup"
    nameTagLogicalId="NameTag"
  }}

  {{
    resource 'instance' logicalId="Instance"
    nameTagLogicalId="NameTag"
    imageIdLogicalId="ImageId"
    keyNameLogicalId="KeyName"
    instanceTypeLogicalId="InstanceType"
    accessKeyLogicalId="AccessKey"
    securityGroupLogicalId="SecurityGroup"
  }}

  {{set 'module:particles-ec2' 'instance_output_all' instanceLogicalId="Instance"}}
  {{set 'module:particles-ec2' 'security_group_output_all' securityGroupLogicalId="SecurityGroup"}}

  {{#output logicalId="UserName"}}
    "Value": {"Ref": "User"}
  {{/output}}

  {{#output logicalId="UserArn"}}
    "Value": {"Fn::GetAtt": ["User","Arn"] }
  {{/output}}

{{/layout}}
