{
"Content":
{
  "schemaVersion": "1.2",
  "description": "ESS for Windows machines - delete VSS",
  "parameters": {
   "vssIds":
    {
      "type":"String",
      "description":"Shadow copies to remove in format \"{ID} {ID} ..\"",
      "allowedPattern": ".*"
    },
    "timeout":
    {
      "type":"String",
      "default":"60",
      "description":"(Optional) The time in seconds for a command to be completed before it is considered to have failed. Default is 60s",
      "allowedPattern":"[1-9][0-9]{1,3}"
    }
  },
  "runtimeConfig": {
    "aws:runPowerShellScript": {
      "properties": [
        {
          "id": "0.aws:runPowerShellScript",
          "runCommand": [
                "$Ids=\"\{{ vssIds }}\"",
                "$Array = [string[]]$Ids.Split()",
                "Get-WmiObject Win32_Shadowcopy | % {",
                "Write-Host \"Checking \"$_.ID",
                "if ($Array -contains $_.ID) {",
                "Write-Host \"Found \"$_.ID",
                "try {",
                "$_.Delete()",
                "}",
                "Catch {",
                "Write-Host \"Error occured while removing\"",
                "}",
                "Finally{",
                "Write-Host \"Item removed\"",
                "}",
                "}",
                "}",
                "Write-Host \"EXIT_RESULT: Success\""
          ],
          "timeoutSeconds": "\{{ timeout }}"
        }
      ]
    }
  }
}

}